extend layout

block scenarios

  //- Left join each scenario with its sessions. Select only launchable scenarios (with documents)
  //- and joinable sessions (with instances).

  -
    var scenario_sessions = scenarios.filter( function( scenario ) {
      return scenario.document;
    } ).reduce( function( scenario_sessions, scenario ) {
      var sessions = ( scenario.sessions || [] ).filter( function( session ) {
        return session.instance;
      } );
      return scenario_sessions.concat( ( [ undefined ].concat( sessions ) ).map( function( session ) {
        return { scenario: scenario, session: session };
      } ) );
    }, [] );

  table.table
    thead
      tr
        th.col-sm-5 Scenario
        th.col-sm-1 Company
        th.col-sm-1 Platoon
        th.col-sm-1 Unit
        th.col-sm-2 &nbsp;
        th.col-sm-1 &nbsp;
        th.col-sm-1 &nbsp;
    tbody: each scenario_session in scenario_sessions
      -
        var scenario = scenario_session.scenario,
          session = scenario_session.session;
      tr
        td= scenario.state.title
          if session
            br
            span.small instructor, n students
        if session
          td= session.state.classroom.company
          td= session.state.classroom.platoon
          td= session.state.classroom.unit
        else
          td &nbsp;
          td &nbsp;
          td &nbsp;
        td &nbsp;
        if session
          td &nbsp;
          td: a(href=session.instance) Join
        else
          td: a(href=scenario.document.uri) Edit
          td: a(href=scenario.document.uri) Launch

block sessions

  //- Join each scenario with its sessions. Select only completed sessions (with documents).

  -
    var scenario_sessions = scenarios.reduce( function( scenario_sessions, scenario ) {
      var sessions = ( scenario.sessions || [] ).filter( function( session ) {
        return session.document;
      } );
      return scenario_sessions.concat( sessions.map( function( session ) {
        return { scenario: scenario, session: session };
      } ) );
    }, [] ).sort( function( a, b ) {
      return b.session.document.timestamp - a.session.document.timestamp;
    } );

  table.table
    thead
      tr
        th.col-sm-5 Scenario
        th.col-sm-1 Company
        th.col-sm-1 Platoon
        th.col-sm-1 Unit
        th.col-sm-3 Date
        th.col-sm-1 &nbsp;
    tbody: each scenario_session in scenario_sessions
      -
        var scenario = scenario_session.scenario,
          session = scenario_session.session;
      tr
        td= session.state.title
        td= session.state.classroom.company
        td= session.state.classroom.platoon
        td= session.state.classroom.unit
        td= ( new Date( session.document.timestamp ) ).toISOString()
        td: a(href=session.document.uri) Review
